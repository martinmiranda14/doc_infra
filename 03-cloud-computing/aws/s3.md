# S3 - Simple Storage Service

## ğŸ“– Â¿QuÃ© es S3?

**Amazon S3** es un servicio de almacenamiento de objetos que ofrece escalabilidad, disponibilidad de datos, seguridad y rendimiento.

```
S3 = Object Storage
- Almacenar y recuperar cualquier cantidad de datos
- Desde cualquier lugar
- Altamente disponible (99.99%)
- Altamente duradero (99.999999999% - 11 nueves)
```

**Casos de uso:**
- Hosting de sitios web estÃ¡ticos
- Backup y restore
- Data lakes y big data analytics
- Almacenamiento de media (imÃ¡genes, videos)
- Software delivery (downloads)
- Disaster recovery

---

## ğŸª£ Conceptos Fundamentales

### Buckets

Contenedores para objetos.

```yaml
Bucket: my-app-bucket-12345

CaracterÃ­sticas:
- Nombre globally unique
- RegiÃ³n especÃ­fica
- Max 100 buckets por cuenta (soft limit)
- Nombres: lowercase, 3-63 caracteres
```

**Naming rules:**
```bash
# âœ… VÃ¡lido
my-app-bucket-2024
company.example.backup

# âŒ InvÃ¡lido
MyAppBucket  # uppercase
my_bucket    # underscores
192.168.1.1  # IP format
```

### Objects

Archivos almacenados en buckets.

```yaml
Object:
  Key: photos/2024/january/photo1.jpg
  Value: <binary data>
  Metadata:
    Content-Type: image/jpeg
    Last-Modified: 2024-01-15
    Custom-Tag: vacation
  Version ID: abc123 (si versioning enabled)
  
Max size: 5TB
Max upload (single PUT): 5GB
Multipart upload: >100MB recomendado
```

**Key naming:**
```
Key = Full path del objeto

photos/2024/january/photo1.jpg
â”‚      â”‚    â”‚       â””â”€ Filename
â”‚      â”‚    â””â”€ Subfolder
â”‚      â””â”€ Subfolder
â””â”€ Folder

âš ï¸ S3 NO tiene folders reales, son prefixes
```

---

## ğŸ’¾ Storage Classes

Diferentes tiers para diferentes patrones de acceso.

### S3 Standard

```yaml
Uso: Datos accedidos frecuentemente

Durabilidad: 99.999999999% (11 nines)
Disponibilidad: 99.99%
AZs: â‰¥3

Latencia: Milisegundos
Costo: $0.023/GB/mes

Ideal para:
- Aplicaciones cloud
- Dynamic websites
- Content distribution
- Big data analytics
```

### S3 Intelligent-Tiering

```yaml
Uso: Patrones de acceso desconocidos o cambiantes

AutomÃ¡ticamente mueve objetos entre tiers:
- Frequent Access (< 30 dÃ­as sin acceso)
- Infrequent Access (30-90 dÃ­as)
- Archive Instant Access (90-180 dÃ­as)
- Archive Access (180+ dÃ­as)
- Deep Archive Access (180+ dÃ­as, optional)

Costo: 
- Storage: VarÃ­a segÃºn tier
- Monitoring: $0.0025/1000 objetos

Ideal para: Data lakes, analytics, logs
```

### S3 Standard-IA (Infrequent Access)

```yaml
Uso: Datos accedidos menos frecuentemente

Durabilidad: 99.999999999%
Disponibilidad: 99.9%
AZs: â‰¥3

Costo storage: $0.0125/GB/mes (45% cheaper)
Retrieval: $0.01/GB
Min storage duration: 30 dÃ­as

Ideal para:
- Backups
- Disaster recovery
- Long-lived data (acceso ocasional)
```

### S3 One Zone-IA

```yaml
Uso: Datos no crÃ­ticos, infrequent access

Durabilidad: 99.999999999% (en 1 AZ)
Disponibilidad: 99.5%
AZs: 1

Costo: $0.01/GB/mes (20% cheaper que Standard-IA)
âš ï¸ Riesgo: Si AZ falla, data se pierde

Ideal para:
- Secondary backups
- Datos re-creables
```

### S3 Glacier Instant Retrieval

```yaml
Uso: Archive data, acceso ocasional inmediato

Retrieval: Milisegundos
Min storage: 90 dÃ­as
Costo: $0.004/GB/mes
Retrieval cost: $0.03/GB

Ideal para:
- Medical images
- News archives
- Datos regulatorios (acceso ocasional)
```

### S3 Glacier Flexible Retrieval

```yaml
Uso: Archive, acceso 1-2 veces/aÃ±o

Retrieval options:
- Expedited: 1-5 min ($0.03/GB)
- Standard: 3-5 horas ($0.01/GB)
- Bulk: 5-12 horas ($0.0025/GB)

Min storage: 90 dÃ­as
Costo: $0.0036/GB/mes

Ideal para: Backups long-term
```

### S3 Glacier Deep Archive

```yaml
Uso: Archive mÃ¡s econÃ³mico, acceso muy raro

Retrieval options:
- Standard: 12 horas
- Bulk: 48 horas

Min storage: 180 dÃ­as
Costo: $0.00099/GB/mes (mÃ¡s barato)

Ideal para:
- Compliance (7-10 aÃ±os)
- Digital preservation
- Tape replacement
```

### ComparaciÃ³n

| Class | $/GB/mes | Retrieval | Use Case |
|-------|----------|-----------|----------|
| Standard | $0.023 | Instant | Frequent |
| Intelligent | ~$0.023 | Instant | Unknown pattern |
| Standard-IA | $0.0125 | Instant | Infrequent |
| One Zone-IA | $0.01 | Instant | Non-critical |
| Glacier Instant | $0.004 | Instant | Archive + occasional |
| Glacier Flexible | $0.0036 | 1-5 hours | Archive |
| Glacier Deep | $0.00099 | 12+ hours | Long-term archive |

---

## ğŸ”’ Seguridad

### Bucket Policies

JSON policy para control de acceso a nivel bucket.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "PublicReadGetObject",
      "Effect": "Allow",
      "Principal": "*",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::my-public-bucket/*"
    }
  ]
}
```

**Ejemplos comunes:**

**Public read:**
```json
{
  "Statement": [{
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::my-bucket/*"
  }]
}
```

**Require HTTPS:**
```json
{
  "Statement": [{
    "Effect": "Deny",
    "Principal": "*",
    "Action": "s3:*",
    "Resource": "arn:aws:s3:::my-bucket/*",
    "Condition": {
      "Bool": {"aws:SecureTransport": "false"}
    }
  }]
}
```

### IAM Policies

Para usuarios/roles, control de quÃ© pueden hacer en S3.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject"
      ],
      "Resource": "arn:aws:s3:::my-bucket/user-uploads/*"
    }
  ]
}
```

### Block Public Access

ProtecciÃ³n a nivel cuenta/bucket.

```yaml
Block all public access: â˜‘ (Recomendado)
  â”œâ”€ Block public ACLs: â˜‘
  â”œâ”€ Ignore public ACLs: â˜‘
  â”œâ”€ Block public bucket policies: â˜‘
  â””â”€ Restrict cross-account access: â˜‘

âš ï¸ Habilitado por default desde 2023
```

### Encryption

#### Encryption at Rest

**SSE-S3 (Server-Side Encryption with S3)**
```yaml
Managed by: AWS
Keys: S3-managed
Tipo: AES-256
Costo: Gratis
Header: x-amz-server-side-encryption: AES256

Default desde 2023
```

**SSE-KMS (Server-Side Encryption with KMS)**
```yaml
Managed by: AWS KMS
Keys: Customer Master Keys (CMK)
Beneficios:
  - Control de keys
  - Audit trail (CloudTrail)
  - Key rotation
Costo: KMS API calls
Header: x-amz-server-side-encryption: aws:kms
```

**SSE-C (Server-Side Encryption with Customer keys)**
```yaml
Managed by: Customer
Keys: Cliente proporciona con cada request
HTTPS: Requerido
Uso: Control total de keys
```

**Client-Side Encryption**
```yaml
Encriptar antes de upload
Desencriptar despuÃ©s de download
Control total del cliente
```

#### Encryption in Transit

```
HTTPS: SSL/TLS
Endpoints:
- https://s3.amazonaws.com
- https://s3-<region>.amazonaws.com
```

---

## ğŸ“ Versionado

### Habilitar Versioning

```bash
aws s3api put-bucket-versioning \
  --bucket my-bucket \
  --versioning-configuration Status=Enabled
```

### Comportamiento

```yaml
Sin versioning:
  Upload file.txt â†’ file.txt (overwrites)

Con versioning:
  Upload file.txt v1 â†’ file.txt (version: abc123)
  Upload file.txt v2 â†’ file.txt (version: def456)
  Upload file.txt v3 â†’ file.txt (version: ghi789)
  
Latest version: ghi789
Previous versions: def456, abc123 (preserved)
```

**Recuperar versiÃ³n:**
```bash
# Listar versiones
aws s3api list-object-versions \
  --bucket my-bucket \
  --prefix file.txt

# Download versiÃ³n especÃ­fica
aws s3api get-object \
  --bucket my-bucket \
  --key file.txt \
  --version-id abc123 \
  file-v1.txt
```

**Delete behavior:**
```yaml
Delete sin versioning:
  â†’ Objeto eliminado permanentemente

Delete con versioning:
  â†’ Delete marker creado
  â†’ Versiones previas preserved
  â†’ Recuperable eliminando delete marker
```

---

## ğŸ”„ Lifecycle Policies

Automatizar transiciÃ³n entre storage classes y eliminaciÃ³n.

```yaml
Lifecycle Rule: archive-old-data

Prefix: logs/
Status: Enabled

Transitions:
  - Days: 30
    Storage class: STANDARD_IA
  
  - Days: 90
    Storage class: GLACIER_IR
  
  - Days: 365
    Storage class: DEEP_ARCHIVE

Expiration:
  - Days: 2555 (7 aÃ±os)
    Permanent delete
```

**Otro ejemplo:**
```yaml
Rule: clean-temp-files

Prefix: temp/
Status: Enabled

Expiration:
  - Days: 7  # Delete after 1 week

Abort incomplete multipart uploads:
  - Days: 1  # Cleanup failed uploads
```

---

## ğŸŒ Static Website Hosting

```bash
# 1. Enable static website hosting
aws s3 website s3://my-website-bucket/ \
  --index-document index.html \
  --error-document error.html

# 2. Upload website files
aws s3 sync ./website/ s3://my-website-bucket/

# 3. Make public (bucket policy)
{
  "Statement": [{
    "Effect": "Allow",
    "Principal": "*",
    "Action": "s3:GetObject",
    "Resource": "arn:aws:s3:::my-website-bucket/*"
  }]
}

# 4. Access
http://my-website-bucket.s3-website-us-east-1.amazonaws.com
```

**Con CloudFront (CDN):**
```yaml
CloudFront Distribution:
  Origin: my-website-bucket.s3.amazonaws.com
  Viewer protocol: Redirect HTTP to HTTPS
  Cache behaviors: Default
  
Benefits:
  - HTTPS
  - Custom domain (example.com)
  - Global edge locations
  - Better performance
```

---

## ğŸš€ Performance

### Transfer Acceleration

```yaml
Enable: Transfer Acceleration

Benefit:
- Upload via edge locations
- 50-500% faster long-distance transfers

Cost: +$0.04/GB

Endpoint cambio:
Before: bucket.s3.amazonaws.com
After:  bucket.s3-accelerate.amazonaws.com
```

### Multipart Upload

```bash
# Recomendado para files >100MB
# Requerido para files >5GB

aws s3api create-multipart-upload \
  --bucket my-bucket \
  --key large-file.zip

# Upload parts en paralelo (hasta 10,000 parts)
# Cada part: 5MB - 5GB

aws s3api upload-part \
  --bucket my-bucket \
  --key large-file.zip \
  --part-number 1 \
  --body part1.dat \
  --upload-id xyz123

# Complete multipart
aws s3api complete-multipart-upload \
  --bucket my-bucket \
  --key large-file.zip \
  --upload-id xyz123 \
  --multipart-upload file://parts.json
```

### Byte-Range Fetches

```bash
# Download solo parte del archivo
aws s3api get-object \
  --bucket my-bucket \
  --key large-video.mp4 \
  --range bytes=0-1048576 \  # First 1MB
  output.mp4

# Ãštil para:
# - Streaming
# - Resumir downloads interrumpidos
# - Parallel downloads
```

### Request Rate Performance

```yaml
Baseline performance:
- 3,500 PUT/POST/DELETE requests/second/prefix
- 5,500 GET/HEAD requests/second/prefix

Prefix = Key hasta Ãºltimo /

Example buckets:
bucket/folder1/file.txt  â†’ prefix: folder1/
bucket/folder2/file.txt  â†’ prefix: folder2/

More prefixes = More throughput
```

---

## ğŸ’° Pricing

### Storage

```
Standard: $0.023/GB/mes (first 50TB)
Standard-IA: $0.0125/GB/mes
Glacier Flexible: $0.0036/GB/mes
Glacier Deep: $0.00099/GB/mes
```

### Requests

```
PUT/POST: $0.005 per 1,000 requests
GET: $0.0004 per 1,000 requests
DELETE: Free
LIST: $0.005 per 1,000 requests
```

### Data Transfer

```
Transfer IN: Free
Transfer OUT to Internet:
  - First 1GB/mes: Free
  - Next 9.999TB: $0.09/GB
  - Next 40TB: $0.085/GB
  
Transfer to CloudFront: Free
Transfer to same region: Free
```

### Ejemplo real:

```yaml
100 GB stored:
  - 50GB Standard: $1.15
  - 50GB Standard-IA: $0.63

100,000 requests:
  - PUT: $0.50
  - GET: $0.04

10GB transfer out: $0.90

Total: ~$3.22/mes
```

---

## ğŸ“‹ CLI Commands

```bash
# Crear bucket
aws s3 mb s3://my-bucket --region us-east-1

# Listar buckets
aws s3 ls

# Upload file
aws s3 cp file.txt s3://my-bucket/
aws s3 cp file.txt s3://my-bucket/folder/

# Upload folder (recursive)
aws s3 sync ./local-folder s3://my-bucket/remote-folder/

# Download
aws s3 cp s3://my-bucket/file.txt ./
aws s3 sync s3://my-bucket/ ./local-folder/

# Listar objetos
aws s3 ls s3://my-bucket/
aws s3 ls s3://my-bucket/folder/ --recursive

# Delete object
aws s3 rm s3://my-bucket/file.txt

# Delete bucket (must be empty)
aws s3 rb s3://my-bucket --force  # Force deletes all objects first

# Presigned URL (temporary access)
aws s3 presign s3://my-bucket/private-file.txt --expires-in 3600
```

---

## ğŸ› Troubleshooting

### Access Denied

```bash
# Check:
1. Bucket policy permite access?
2. IAM policy permite action?
3. Block Public Access settings?
4. Object ACLs?

# Debug
aws s3api get-bucket-policy --bucket my-bucket
aws s3api get-bucket-acl --bucket my-bucket
aws s3api get-object-acl --bucket my-bucket --key file.txt
```

### Slow Upload/Download

```bash
# Solutions:
1. Use Transfer Acceleration
2. Use Multipart upload
3. Parallel transfers (aws s3 sync uses this)
4. Use CloudFront for downloads
5. Check your internet connection/bandwidth
```

### High Costs

```bash
# Investigate:
1. CloudWatch â†’ S3 metrics
2. Cost Explorer â†’ S3 breakdown
3. S3 Storage Lens (analytics)

# Common culprits:
- Many small files (request costs)
- Frequent transitions (lifecycle costs)
- Data transfer out
- Retrieval from Glacier

# Optimize:
- Batch small files
- Review lifecycle policies
- Use CloudFront
- Delete unnecessary data
```

---

## ğŸ“š Best Practices

```yaml
Security:
  âœ… Enable versioning
  âœ… Enable logging
  âœ… Enable MFA Delete (production)
  âœ… Encrypt by default (SSE-S3 minimum)
  âœ… Block Public Access (unless needed)
  âœ… Use IAM roles, not access keys

Performance:
  âœ… Use Transfer Acceleration para long-distance
  âœ… Multipart upload para >100MB
  âœ… CloudFront para static content
  âœ… Multiple prefixes para high throughput

Cost:
  âœ… Lifecycle policies
  âœ… Intelligent-Tiering para unknown patterns
  âœ… Delete incomplete multipart uploads
  âœ… Monitor with S3 Storage Lens
  âœ… Compress files antes de upload

Durability:
  âœ… Cross-Region Replication (critical data)
  âœ… Versioning enabled
  âœ… Regular backups verification
```

---

## ğŸ“š PrÃ³ximos Pasos

Con S3 dominado:

1. [**RDS**](./rds.md) â†’ Bases de datos gestionadas
2. [**Lambda**](./lambda.md) â†’ Serverless compute
3. [**CloudFront**](./cloudfront.md) â†’ CDN
4. [**IAM**](./iam.md) â†’ Security avanzado

---

[â¬…ï¸ Volver: EC2](./ec2.md) | [â¡ï¸ Siguiente: RDS](./rds.md)

> âš™ï¸ **Nota**: Este documento fue generado con asistencia de IA (Claude Code). Se recomienda revisar y validar el contenido antes de su uso en producciÃ³n.
